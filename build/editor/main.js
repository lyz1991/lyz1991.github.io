!function(e){var n={};function t(i){if(n[i])return n[i].exports;var o=n[i]={i:i,l:!1,exports:{}};return e[i].call(o.exports,o,o.exports,t),o.l=!0,o.exports}t.m=e,t.c=n,t.d=function(e,n,i){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:i})},t.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},t.p="",t(t.s=0)}([function(e,n,t){"use strict";t.r(n);var i={query:e=>document.querySelector(e),append(e,n){e.appendChild(n)},isDomList:e=>e instanceof HTMLCollection,getRangeInContainer(e,n){if(!n)return;let t=n.commonAncestorContainer;for(;t=t.parentNode;)if(1==t.nodeType&&t.id==e.id)return!0;return!1},getNode:e=>1==e.nodeType?e:e.parentNode,insertAfter(e,n){let t=n.parentNode;t.lastChild==n?t.appendChild(e):t.insertBefore(e,n.nextSibling)},trim:e=>e.trim()};class o{constructor(e){let n;if(this.selector=e,e instanceof o)return e;1==e.nodeType&&(n=[e]),"string"==typeof e&&(n=0==e.indexOf("<")?function(e){let n=document.createElement("div");return n.innerHTML=e,n.children}(e):document.querySelectorAll(e));for(let e=0,t=n.length;e<t;e++)this[e]=n[e]}children(e){for(let n=0,t=this[0].children.length;n<t;n++)if(e.toUpperCase()==this[0].children[n].nodeName)return this[0].children[n];return{}}}let a=e=>new o(e);var r={name:"color",tpl:'<li name="color"><i class="i-color"></i> <i class="i-down"></i> </li>',events:[{type:"mouseenter",cb(e){a(e.currentTarget).children("ul").style.display="flex"}},{type:"mouseleave",cb(e){a(e.currentTarget).children("ul").style.display="none"}}]},l={do(e,n,t){document.execCommand(e,!1,n),t.change&&t.change()}},c={saveRange(e){if(!e)return;let n=window.getSelection();n.removeAllRanges(),n.addRange(e)},createRange(e,n=!1,t){const i=document.createRange();n?i.selectNode(e):i.selectNodeContents(e),t.orirange=i,this.saveRange(i)}},s={name:"bold",tpl:'<li name="bold"><i class="i-bold"></i> </li>',events:[{type:"click",cb(e,n){i.getRangeInContainer(n,n.orirange)&&(c.saveRange(n.orirange),l.do("bold",window.getSelection(),n))}}]},d={name:"italic",tpl:'<li name="italic"><i class="i-italic"></i> </li>',events:[{type:"click",cb(e,n){i.getRangeInContainer(n,n.orirange)&&(c.saveRange(n.orirange),l.do("italic",window.getSelection(),n))}}]},u={name:"strike",tpl:'<li name="strike"><i  class="i-strike"></i> </li>',events:[{type:"click",cb(e,n){i.getRangeInContainer(n,n.orirange)&&(c.saveRange(n.orirange),l.do("StrikeThrough",window.getSelection(),n))}}]},h={name:"formatBlock",events:[{type:"mouseenter",cb(e){this.active=!1,a(e.currentTarget).children("ul").style.display=this.active?"none":"block"}},{type:"mouseleave",cb(e){this.active=!0,a(e.currentTarget).children("ul").style.display=this.active?"none":"block"}}],tpl:'<li name="formatBlock"><i class="i-header"></i><i class="i-down"></i> </li>',active:!1},g={name:"horizontal",tpl:'<li name="horizontal"><i class="i-horizontal"></i> </li>',events:[{type:"click",cb(e,n){let t=document.createDocumentFragment(),o=document.createElement("hr");if(t.appendChild(o),i.append(t,a("<p><br></p>")[0]),n.orirange)return c.saveRange(n.orirange),window.getSelection().toString()||n.orirange.commonAncestorContainer?(n.container.appendChild(t),n.change()):(i.insertAfter(t,n.orirange.commonAncestorContainer),n.change());n.container.appendChild(t)}}]};class p{constructor(e,n,t,i){let o=document.createDocumentFragment(),a=document.createElement("ul");a.className="eleContainer",a.style.display="none",o.appendChild(a);for(let n=0,t=e.length;n<t;n++){let t=document.createElement("li");t.setAttribute("value",e[n].value),t.innerHTML=e[n].html,a.appendChild(t)}n.appendChild(o),this.bind(a,t,i)}bind(e,n,t){e.addEventListener("click",function(e){e.stopPropagation(),c.saveRange(n.orirange),l.do(t,e.target.getAttribute("value"),n)})}}var m={name:"BackColor",tpl:'<li name="BackColor"><i class="i-bgcolor"></i><i class="i-down"></i> </li>',events:[{type:"mouseenter",cb(e){a(e.currentTarget).children("ul").style.display="flex"}},{type:"mouseleave",cb(e){a(e.currentTarget).children("ul").style.display="none"}}]};const v=["red","orange","yellow","green","cyan","blue","purple","pink","gray","brown","yellowgreen","skyblue"];var f={init(e,n,t){let i=document.createDocumentFragment(),o=document.createElement("ul");o.className="color-container",i.appendChild(o);for(let e=0;e<v.length;e++){let n=document.createElement("li");n.className="color-item",n.style.backgroundColor=v[e],o.appendChild(n)}e.appendChild(i),this.bind(n,o,t)},bind(e,n,t){n.addEventListener("click",n=>{if(console.log(e.orirange),i.getRangeInContainer(e,e.orirange)){let i=n.target.style.backgroundColor;c.saveRange(e.orirange),document.execCommand(t,!1,i)}})}},y={name:"face",tpl:'<li name="face"><i class="i-face"></i> </li>',events:[{type:"click",cb(e,n){i.getRangeInContainer(n,n.orirange)&&(c.saveRange(n.orirange),this.active||(this.active=!0,l.do("italic",window.getSelection(),n)))}}],active:!1};var b={name:"href",active:!1,tpl:'<li name="href"><i class="i-href"></i> </li>',events:[{type:"click",cb(e,n){(new class{init(e,n){if(!window.Dialog)return document.body.appendChild(a(`<div class="dialog" id="dialog">${e}</div>`)[0]),this.id=document.getElementById("dialog"),this.bind(),n&&n(),this.prevent(),window.Dialog=this;window.Dialog.show(e,n)}show(e,n){this.id.innerHTML=e,this.id.style.display="block",n&&n(),this.prevent(e)}bind(){this.id.addEventListener("click",function(){window.Dialog.hide()})}prevent(){this.id.children[0].addEventListener("click",function(e){e.stopPropagation()})}hide(){this.id.style.display="none"}}).init('<div class="container">\n<h3>插入链接</h3>\n<div class="item">\n<span><i class="i-href"></i></span>\n<input type="text" id="href"/> \n</div>\n<div class="item">\n<span><i class="i-charactor"></i></span>\n<input type="text" id="val"> \n</div>\n<button id="sure">确定</button></div>',function(){document.getElementById("sure").addEventListener("click",function(){window.Dialog.hide(),c.saveRange(n.orirange),l.do("insertHTML",`<a href="${document.getElementById("href").value}">${document.getElementById("val").value}</a>`,n)})})}}]},w={name:"font",tpl:'<li name="font"><i class="i-font"></i><i class="i-down"></i> </li>',active:!1,events:[{type:"mouseenter",cb(e){this.active=!1,a(e.currentTarget).children("ul").style.display=this.active?"none":"block"}},{type:"mouseleave",cb(e){this.active=!0,a(e.currentTarget).children("ul").style.display=this.active?"none":"block"}}]},C={name:"undo",tpl:'<li name="undo"><i class="i-undo"></i> </li>',events:[{type:"click",cb(e,n){i.getRangeInContainer(n,n.orirange)&&(c.saveRange(n.orirange),l.do("Undo",window.getSelection(),n))}}]},k={name:"quote",tpl:'<li name="quote"><i  class="i-quote"></i> </li>',events:[{type:"click",cb(e,n){i.getRangeInContainer(n,n.orirange)&&(c.saveRange(n.orirange),l.do("formatBlock","<BLOCKQUOTE>",n))}}]},R={name:"publish",tpl:'<li name="publish"><i class="i-publish"></i>发布文章 </li>',events:[{type:"click",cb(e,n){n.publish()}}]};class E{constructor(e,n){this.bold=s,this.italic=d,this.strike=u,this.formatBlock=h,this.color=r,this.horizontal=g,this.BackColor=m,this.href=b,this.face=y,this.undo=C,this.font=w,this.quote=k,this.publish=R,this.init(e,n),f.init(i.query("li[name='color']"),e,"ForeColor"),f.init(i.query("li[name='BackColor']"),e,"BackColor")}init(e,n){let t=document.createDocumentFragment();for(let e of n.menus)i.append(t,a(this[e].tpl)[0]);i.append(e.configContainer,t),new p([{html:"H1",value:"<h1>"},{html:"H2",value:"<h2>"},{html:"H3",value:"<h3>"},{html:"H4",value:"<h4>"}],e.configContainer.querySelector("li[name='formatBlock']"),e,"formatBlock"),new p([{html:"宋体",value:"宋体"},{html:"微软雅黑",value:"微软雅黑"},{html:"Arial",value:"Arial"}],e.configContainer.querySelector("li[name='font']"),e,"FontName"),this.bind(e,n)}bind(e,n){document.createRange();for(let t of n.menus){let n=e.configContainer.querySelector(`li[name=${t}]`);this[t].events.forEach(t=>{n.addEventListener(t.type,n=>{t.cb(n,e)})})}}}t(2),new class{constructor(e,n,t={}){this.container=i.query(e),this.id=this.container.id,this.configContainer=i.query(n),this.change=t.change,this.publish=t.publish,new E(this,t),this._initDom(e),this._bindEvent(this)}_initDom(e){i.append(this.container,a("<p><br></p>")[0])}_bindEvent(e){this.container.addEventListener("mousedown",e=>{this.container.addEventListener("mouseleave",e=>{this.orirange=window.getSelection().getRangeAt(0)}),this.container.addEventListener("keyup",e=>{this.orirange=window.getSelection().getRangeAt(0)})}),this.container.addEventListener("keydown",n=>{if(this.orirange=window.getSelection().getRangeAt(0),8==n.keyCode&&"<p><br></p>"==i.trim(this.container.innerHTML)&&n.preventDefault(),13==n.keyCode){n.preventDefault();const t=a("<p><br></p>")[0];i.insertAfter(t,this.orirange.commonAncestorContainer),c.createRange(t,!1,e)}})}}("#editor","#config",{menus:["formatBlock","bold","italic","strike","horizontal","color","BackColor","href","face","font","undo","quote","publish"],change(){console.log("ajax")},publish(){document.querySelector("#content").innerHTML=document.querySelector("#editor").innerHTML,document.querySelector("#editor").innerHTML="",console.log("published")}})},,function(e,n,t){}]);